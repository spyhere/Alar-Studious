<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alar_02</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    .list {
        min-height: 50vh;
    }
    #input {
        display: block;
        width: fit-content;
        margin: auto;
        margin-top: 1em;
    }
    .list table {
        position: relative;
        left: 50%;
        transform: translateX(-50%);
        width: 40%;
        margin: 1em;
        border-collapse: collapse;
        font-family: arial, sans-serif;
    }
    tr, th {
        border: 1px solid #dddddd;
    }
    #input tr, #input th {
        border: none;
    }
    th {
        padding: 1em;
    }
    .tr__buttons {
        padding: 0;
        user-select: none;
    }
    button {
        height: 3em;
        width: 4em;
        border-radius: 5px;
        border-bottom: double;
    }
    button:active {
        border-bottom: solid;
        border-width: 1px;
    }
    button:focus {
        outline: none;
    }
    tr:nth-child(even) {
        background-color: #bbbbbb;
    }
    .input__edit {
        font-size: 1rem;
        height: 1.5em;
        margin: 0;
        box-shadow: 0px 2px 4px;
    }
    input {
        font-size: 1.5em;
        width: 10em;
        height: 2em;
        margin: 5px 5px;
        padding-left: 5px;
        border-radius: 5px;
        border: none;
        box-shadow: 0px 3px 6px;
        transition-duration: .5s;
    }
    input:focus {
        outline: none;
        box-shadow: 0px 1px 2px;
    }
    .save {
        background-color: rgb(0 255 112);
    }
    .create_button:active {
        background-color: #000000;
        color: #aaaaaa;
    }
    .warning {
        display: none;
        position: absolute;
        pointer-events: none;
        min-width: 100px;
        min-height: 50px;
        background-color: azure;
        border: 1px dashed;
        border-radius: 10px;
        opacity: 1;
        z-index: 100;
        animation: warning_fadeOut 2s ease-in-out 2s 1 forwards;
    }
    .warning__descr {
        padding: 1em;
    }
    .warning__descr h1 {
        font-size: 1.5em;
    }
    @keyframes warning_fadeOut {
        100% {opacity: 0;}
    }
</style>
<body>
    <div class="warning" style="display: none">
        <div class="warning__descr">
            <h1>Error</h1>
            <p>Name with minumum 2 letters for name (only letters)</p>
            <p>Number: min 6, max 13 digits</p>
        </div>
    </div>
    <hr>
    <div class="app">
        <div class="list">
            <table></table>
        </div>
        <hr style="border: 2px dashed rgba(0, 0, 0, 0.1);">
        <section id="input">
            <table>
                <tr>
                    <th class="tr__buttons">
                        <input type="text">
                    </th>
                    <th class="tr__buttons">
                        <input type="text">
                    </th>
                    <th class="tr__buttons">
                        <button class="create_button" onclick="createFunc(this)">Create</button>
                    </th>
                </tr>
            </table>
        </section>
    </div>
</body>
<script>



    // DATA BASE
    let db = [["Евгений Пономарев", "+380962468671"], ["Lorem ipsum dolor", "+380962468671"], ["Lorem ipsum", "+380962468671"], ["Lorem", "+380962468671"], ["Eugene Ponomarov", "+971508979966"]];   


    // AJAX
    // var XMLHttpRequest = require('xmlhttprequest').XMLHttpRequest;
    // const req = new XMLHttpRequest();
    // req.open("GET", '/json/db', true);
    // req.timeout = 10000;
    // req.send();

    // req.onload = () => {
    //     if (req.status !== 200) {
    //         console.log("Error");
    //     } else {
    //         db = JSON.parse(req.responseText);
    //     }
    // }
    // req.onerror = (error) => {
    //     console.error(error);
    // }

    // RENDERING THE LIST
    function buildUp() {

        let table = document.querySelector(".list table");
        if (table.hasChildNodes()) {
            let list = document.querySelector(".list");
            list.removeChild(table);
            list.appendChild(document.createElement("table"));
        }
        
       db.forEach((elem, ind) => {
        let tr = document.createElement("tr");

        tr.innerHTML = `<th>${elem[0]}</th>
                        <th>${elem[1]}</th>
                        <th class="tr__buttons">
                            <button data-index="${ind}" onclick="editFunc(this)">Edit</button>
                            <button data-index="${ind}" onclick="deleteFunc(this)">Delete</button>
                        </th>`;
        document.querySelector("table").appendChild(tr);
        }); 
    }

    buildUp();

    // EDITING
    function editFunc(e) {
        if (!document.querySelectorAll('.input__edit').length || e.innerText === "Save") {
            if (e.innerText === "Edit") {
                e.innerText = "Save";
                e.classList.toggle("save");

                let tr = e.parentNode.parentNode;
                let thName = tr.childNodes[0];
                let thNumber = tr.childNodes[2];

                let inputName = document.createElement("input");
                let inputNumber = document.createElement("input");

                inputName.setAttribute('value', thName.innerText);
                inputName.setAttribute('class', "input__edit");
                inputNumber.setAttribute('value', thNumber.innerText);
                inputNumber.setAttribute('class', "input__edit");

                thName.innerText = '';
                thNumber.innerText = '';

                thName.appendChild(inputName);
                thNumber.appendChild(inputNumber);
            } else {
                saveEdits(e);
            }
        }
    }

    // SAVING CHANGINGS
    function saveEdits(e) {
        let data = document.querySelectorAll('.input__edit');
        let newName = data[0].value;
        let newNumber = data[1].value;

        if (validation(newName, newNumber)) {
            data[0].parentElement.innerHTML = newName;
            data[1].parentElement.innerHTML = newNumber;
            db[e.dataset.index] = [newName, newNumber];

            e.innerText = "Edit";
            e.classList.toggle("save");

            // AJAX
            // req.open("POST", '/json/db', true);
            // req.send(JSON.stringify(db));
        } else {
            warningPopOut(e);
        }
    }

    // DELETING THE PERSON
    function deleteFunc(e) {
        db.splice(e.dataset.index, 1);
        buildUp();

        // AJAX
        // req.open("POST", '/json/db', true);
        // req.send(JSON.stringify(db));
    }

    // CREATING NEW PERSON IN THE LIST
    function createFunc(e) {

        let parent = e.parentElement.parentElement;
        let newName = parent.childNodes[1].childNodes[1];
        let newNumber = parent.childNodes[3].childNodes[1];
        
        if (validation(newName.value, newNumber.value)) {
            db.push([newName.value, newNumber.value]);

            newName.value = '';
            newNumber.value = '';

            buildUp();

            // AJAX
            // req.open("POST", '/json/db', true);
            // req.send(JSON.stringify(db));
        } else {
            warningPopOut(e);
            
        }  
    }

    // VALIDATION FUNCTION
    function validation(newName, newNumber) {
        let validationName = newName.match(/(([a-z]|[A-Z]|[\u0400-\u04FF]|[ ])+){2,}/g); 
        let validationNumber = newNumber.match(/((^[+]|^\d+|[-])([-]|)?(\d{2,}))+/g);

        if (validationName && validationName[0].length === newName.length &&
            validationNumber && validationNumber[0].length === newNumber.length && newNumber.length >= 6 && newNumber.length <= 13 ) {
            return true;
        } else {
            return false;
        }
    }

    // WARNING POPOUT
    function warningPopOut(e) {
        let warning = document.querySelector(".warning");
            if (warning.style.display === "none") {
                warning.style.display = "block";
                let coordinates = e.getBoundingClientRect();
                warning.style.top = `${coordinates.top - warning.getBoundingClientRect().height - 3}px`;
                warning.style.left = coordinates.left - warning.getBoundingClientRect().width / 4 + "px";
                setTimeout(() => warning.style.display = "none", 4000);
            }
    }
</script>
</html>