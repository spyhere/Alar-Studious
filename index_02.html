<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alar_02</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    .list {
        min-height: 50vh;
    }
    #input {
        display: block;
        width: fit-content;
        margin: auto;
        margin-top: 1em;
    }
    .list table {
        position: relative;
        left: 50%;
        transform: translateX(-50%);
        width: 40%;
        margin: 1em;
        border-collapse: collapse;
        font-family: arial, sans-serif;
    }
    tr, th {
        border: 1px solid #dddddd;
    }
    #input tr, #input th {
        border: none;
    }
    th {
        padding: 1em;
    }
    .tr__buttons {
        padding: 0;
        user-select: none;
    }
    button {
        height: 3em;
        width: 4em;
        border-radius: 5px;
        border-bottom: double;
    }
    button:active {
        border-bottom: solid;
        border-width: 1px;
    }
    button:focus {
        outline: none;
    }
    tr:nth-child(even) {
        background-color: #bbbbbb;
    }
    .input__edit {
        font-size: 1rem;
        height: 1.5em;
        margin: 0;
        box-shadow: 0px 2px 4px;
    }
    input {
        font-size: 1.5em;
        width: 10em;
        height: 2em;
        margin: 5px 5px;
        padding-left: 5px;
        border-radius: 5px;
        border: none;
        box-shadow: 0px 3px 6px;
        transition-duration: .5s;
    }
    input:focus {
        outline: none;
        box-shadow: 0px 1px 2px;
    }
    .save {
        background-color: rgb(0 255 112);
    }
    .create_button:active {
        background-color: #000000;
        color: #aaaaaa;
    }
</style>
<body>
    <hr>
    <div class="app">
        <div class="list">
            <table></table>
        </div>
        <hr style="border: 2px dashed rgba(0, 0, 0, 0.1);">
        <section id="input">
            <table>
                <tr>
                    <th class="tr__buttons">
                        <input type="text">
                    </th>
                    <th class="tr__buttons">
                        <input type="text">
                    </th>
                    <th class="tr__buttons">
                        <button class="create_button" onclick="createFunc(this)">Create</button>
                    </th>
                </tr>
            </table>
        </section>
    </div>
</body>
<script>

    // DATA BASE
    const DB = [["Евгений Пономарев", "+380962468671"], ["Lorem, ipsum dolor.", "+380962468671"], ["Lorem, ipsum.", "+380962468671"], ["Lorem.", "+380962468671"], ["Eugene Ponomarov", "+971508979966"]];   

    // RENDERING THE LIST
    function buildUp() {

        let table = document.querySelector(".list table");
        if (table.hasChildNodes()) {
            let list = document.querySelector(".list");
            list.removeChild(table);
            list.appendChild(document.createElement("table"));
        }
        
       DB.forEach((elem, ind) => {
        let tr = document.createElement("tr");

        tr.innerHTML = `<th>${elem[0]}</th>
                        <th>${elem[1]}</th>
                        <th class="tr__buttons">
                            <button data-index="${ind}" onclick="editFunc(this)">Edit</button>
                            <button data-index="${ind}" onclick="deleteFunc(this)">Delete</button>
                        </th>`;
        document.querySelector("table").appendChild(tr);
        }); 
    }

    buildUp();

    // EDITING
    function editFunc(e) {
        if (!document.querySelectorAll('.input__edit').length || e.innerText === "Save") {
            if (e.innerText === "Edit") {
                e.innerText = "Save";
                e.classList.toggle("save");

                let tr = e.parentNode.parentNode;
                let thName = tr.childNodes[0];
                let thNumber = tr.childNodes[2];

                let inputName = document.createElement("input");
                let inputNumber = document.createElement("input");

                inputName.setAttribute('value', thName.innerText);
                inputName.setAttribute('class', "input__edit");
                inputNumber.setAttribute('value', thNumber.innerText);
                inputNumber.setAttribute('class', "input__edit");


                thName.innerText = '';
                thNumber.innerText = '';

                thName.appendChild(inputName);
                thNumber.appendChild(inputNumber);


            } else {
                e.innerText = "Edit";
                e.classList.toggle("save");
                saveEdits(e);
            }
        }
    }

    // SAVING CHANGINGS
    function saveEdits(e) {
        let data = document.querySelectorAll('.input__edit');
        let newName = data[0].value;
        let newNumber = data[1].value;

        if (validation(newName, newNumber)) {
            data[0].parentElement.innerHTML = newName;
            data[1].parentElement.innerHTML = newNumber;
            DB[e.dataset.index] = [newName, newNumber];
        } else {
            console.log("fail edit")
        }
    }

    // DELETING THE PERSON
    function deleteFunc(e) {
        DB.splice(e.dataset.index, 1);
        buildUp();
    }

    // CREATING NEW PERSON IN THE LIST
    function createFunc(e) {

        let parent = e.parentElement.parentElement;
        let newName = parent.childNodes[1].childNodes[1];
        let newNumber = parent.childNodes[3].childNodes[1];
        
        if (validation(newName.value, newNumber.value)) {
            DB.push([newName.value, newNumber.value]);

            newName.value = '';
            newNumber.value = '';

            buildUp();
        } else {
            console.log("fail")
        }  
    }

    // VALIDATION FUNCTION
    function validation(newName, newNumber) {
        let validationName = newName.match(/(([a-z]|[A-Z]|[ ])+){2,}/g); 
        let validationNumber = newNumber.match(/((^[+]|^\d+|[-])([-]|)?(\d{2,}))+/g);

        if (validationName && validationName[0].length === newName.length &&
            validationNumber && validationNumber[0].length === newNumber.length && newNumber.length >= 6 && newNumber.length <= 10 ) {
            return true;
        } else {
            return false;
        }
    }
</script>
</html>